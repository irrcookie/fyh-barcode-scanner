// ... (ä¿ç•™ CSS å’Œ HTML body éƒ¨åˆ†ä¸è®Š)

    <script>
        // ğŸ“Œ Google Form æäº¤çµ‚é» URL
        const FORM_SUBMISSION_URL = 'https://docs.google.com/forms/d/e/1FAIpQLSfZUGam9VPr8zRp5KqoW5V2V-egh_1euYde99oVT0HQ_M_NAw/formResponse'; 
        
        // ğŸ“Œ Google Form æ¢ç¢¼æ¬„ä½åç¨± (entry ID)
        const BARCODE_ENTRY_ID = 'entry.1388839353'; 

        const html5Qrcode = new Html5Qrcode("reader");
        const barcodeInput = document.getElementById("barcode_input");
        const statusMessage = document.getElementById("status");
        
        // å•Ÿå‹•æƒæå™¨å‡½æ•¸
        function startScanner() {
            // å…ˆåœæ­¢æ­£åœ¨é‹è¡Œçš„æƒæå™¨
            if (html5Qrcode.isScanning) {
                html5Qrcode.stop().then(() => {
                    _executeStartScanner();
                }).catch(() => {
                    _executeStartScanner();
                });
            } else {
                _executeStartScanner();
            }
        }

        // å¯¦éš›åŸ·è¡Œå•Ÿå‹•çš„å‡½æ•¸
        function _executeStartScanner() {
            // é•·æ–¹å½¢æƒææ¡†è¨­ç½®
            const config = { 
                fps: 10, 
                qrbox: { width: 300, height: 150 }, 
                facingMode: "environment" 
            };

            html5Qrcode.start({ facingMode: "environment" }, config, onScanSuccess, onScanError)
            .catch((err) => {
                 statusMessage.textContent = "âŒ é¡é ­å•Ÿå‹•å¤±æ•—ï¼è«‹æª¢æŸ¥æ¬Šé™ã€‚";
                 console.error("Camera start failed:", err);
            });
        }
        
        // æƒææˆåŠŸè™•ç†å‡½æ•¸
        function onScanSuccess(decodedText, decodedResult) {
            barcodeInput.value = decodedText;
            statusMessage.textContent = "âœ… æƒææˆåŠŸï¼š" + decodedText;
            // æƒææˆåŠŸå¾Œåœæ­¢é¡é ­ï¼Œç­‰å¾…ç”¨æˆ¶ç¢ºèªæäº¤
            html5Qrcode.stop().then(() => {}).catch(() => {});
        }
        
        function onScanError(errorMessage) {}

        // --- å½ˆå‡ºç¢ºèªè¦–çª—ä¸¦è™•ç†çµæœ ---
        function confirmSubmission() {
            const barcode = barcodeInput.value;
            if (!barcode) { 
                statusMessage.textContent = "âš ï¸ è«‹å…ˆæƒææ¢ç¢¼ï¼";
                return;
            }

            // é€™è£¡ä¸å†éœ€è¦åœæ­¢é¡é ­ï¼Œå› ç‚ºæƒææˆåŠŸæ™‚å·²ç¶“åœæ­¢äº†
            
            const isConfirmed = window.confirm(`ä½ ç¢ºå®šè¦æäº¤æ¢ç¢¼ï¼š${barcode} å—ï¼Ÿ`);

            if (isConfirmed) {
                submitData(barcode);
            } else {
                // å¦‚æœå–æ¶ˆï¼Œå‰‡é‡æ–°å•Ÿå‹•æƒæ
                barcodeInput.value = ""; 
                statusMessage.textContent = "å·²å–æ¶ˆæäº¤ã€‚é‡æ–°å•Ÿå‹•æƒæå™¨...";
                startScanner(); // é‡æ–°å•Ÿå‹•æƒæå™¨
            }
        }
        
        // --- æ ¸å¿ƒæäº¤å‡½æ•¸ (ä¿®æ”¹ç‚ºè·³è½‰) ---
        function submitData(barcode) {
            statusMessage.textContent = "â³ æ•¸æ“šå‚³è¼¸ä¸­ï¼Œè«‹ç¨å€™...";
            
            const formData = new FormData();
            formData.append(BARCODE_ENTRY_ID, barcode);

            fetch(FORM_SUBMISSION_URL, {
                method: 'POST',
                body: new URLSearchParams(formData),
                redirect: 'manual' 
            })
            .then(response => {
                // æª¢æŸ¥æ˜¯å¦æˆåŠŸæ¥æ”¶ (302 æˆ– opaque)
                if (response.status === 302 || response.type === 'opaque') {
                    // *** æˆåŠŸå¾Œï¼Œè·³è½‰åˆ° success.html é é¢ ***
                    window.location.href = 'success.html'; 
                } else {
                    statusMessage.textContent = "âŒ æäº¤å¤±æ•—ï¼Form æœå‹™å™¨éŒ¯èª¤ã€‚";
                    console.error('Form submission failed with status:', response.status);
                    startScanner(); // å¤±æ•—å¾Œé‡æ–°å•Ÿå‹•
                }
            })
            .catch(error => {
                statusMessage.textContent = "âŒ å‚³è¼¸å¤±æ•—ï¼è«‹æª¢æŸ¥ç¶²çµ¡æˆ– Forms è¨­å®šã€‚";
                console.error('çœŸæ­£çš„ç¶²çµ¡éŒ¯èª¤:', error);
                startScanner(); // å¤±æ•—å¾Œé‡æ–°å•Ÿå‹•
            });
        }

        // é é¢è¼‰å…¥å¾Œï¼Œç«‹å³å•Ÿå‹•æƒæå™¨
        startScanner();
    </script>
</body>
</html>
